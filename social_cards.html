<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
        <script src="//cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>

        <script type="application/javascript">
            var injectedObject = {
                "title": "Join League of Kingdoms Socials",
                "description": "$1 reward (2 $LOKA token) for first 1000 to complete.",
                "url": "https://www.w3schools.com/howto/howto_css_social_cards.asp",
                "image": "https://www.w3schools.com/howto/img_avatar.png",
                "claimString": "80/100",
                "twitterComplete": true,
                "discordComplete": false,
                "gameName": "League of Kingdoms",
            };

            var job = {
                "tasks": [
                    {
                        "type": "SOCIAL_CONNECT",
                        "taskId": 1
                    }
                ],
                "funded": true,
                "countClaimed": 0,
                "_id": 13,
                "companyId": "62fd0e1b5f653536e9c657a8",
                "payerId": 10,
                "title": "Use task's description",
                "description": "Use task's descriptopn 1000 usdc",
                "image": "Use task's logo",
                "videoUri": {
                    "ENGLISH": "blabla"
                },
                "payout": {
                    "amount": 1000,
                    "currencyId": 8
                },
                "jobType": "MIXED",
                "stage": "DEVELOPMENT",
                "onComplete": "Claim 1000 usdc",
                "onAlreadyCompleted": "Won 1000 usdcs",
                "maxClaims": 100,
                "active": true,
                "createdAt": "2022-10-08T12:21:03.628Z",
                "updatedAt": "2022-10-08T13:00:16.375Z",
                "__v": 1,
                "endTime": "2022-10-08T20:00:00.000Z",
                "id": 13,
                "status": "PENDING",
                "isPaidOut": false,
                "payoutsDone": {},                
            }

            var task =  {
                "_id": 1,
                "companyId": "62fd0e1b5f653536e9c657a8",
                "payerId": 10,
                "type": "SOCIAL_CONNECT",
                "title": "Join League of Kingdoms Socials",
                "descriptionButtonText": "$1 reward (2 $LOKA token)for first 1000 to complete",
                "descriptionButtonLogo": "https://cdn-m.namasteapis.com/crypto/LOK/lok_descr_logo.png",
                "socials": [
                    {
                        "type": "TWITTER",
                        "displayId": "irshashank",
                        "id": "11",
                        "url": "https://twitter.com/intent/follow?screen_name=irshashank",
                        "buttonText": "Follow"
                    }
                ],
                "onComplete": "Claim",
                "onAlreadyCompleted": "You won {{payoutString}}",
                "createdAt": "2022-10-08T12:16:17.253Z",
                "updatedAt": "2022-10-08T12:16:17.253Z",
                "__v": 0,
                "id": 1,
                "status": "COMPLETED",
                "connected": {
                    TWITTER: true,
                    DISCORD: false
                }
            }

            var payer = {
                "active": true,
                "_id": 10,
                "companyId": "62fd0e1b5f653536e9c657a8",
                "name": "League of Kingdoms",
                "title": "Play and win crypto",
                "description": "Win upto 1000 usdc",
                "image": "https://www.leagueofkingdoms.com/img/logo_mini.png",
                "logo": "https://www.leagueofkingdoms.com/img/logo_mini.png",
                "stage": "DEVELOPMENT",
                "location": {
                    "type": "ANDROID",
                    "name": "com.nplusent.lok"
                },
                "custodianWalletId": "633edbc69a322497b5965019",
                "createdAt": "2022-10-06T13:44:38.313Z",
                "updatedAt": "2022-10-08T12:26:11.169Z",
                "__v": 0,
                "jobIds": [
                    13
                ],
                "totalPayout": [
                    {
                        "amount": 1000,
                        "currencyId": 8
                    }
                ],
                "progressBar": {
                    "done": 0,
                    "total": 1
                },
                "chips": [
                    "0/1 challenges done",
                    "₹79763.62/₹79763.62 earned"
                ]
            }

            const gameName = payer.name;

            showModalTwitter = function() {
                document.getElementById("twittermodal").style.display = "block";
            }

            closeModalTwitter = function() {
                document.getElementById("twittermodal").style.display = "none";
            }

            showModalDiscord = function() {
                document.getElementById("discordmodal").style.display = "block";
            }

            closeModalDiscord = function() {
                document.getElementById("discordmodal").style.display = "none";
            }

            // update title text with claimString
            document.addEventListener("DOMContentLoaded", function(event) {
                document.getElementById("title").innerHTML = task.title;
            });

            // update description text with claimString
            document.addEventListener("DOMContentLoaded", function(event) {
                document.getElementById("description").innerHTML = task.descriptionButtonText;
            });

            // update claimed-title text with claimString
            document.addEventListener("DOMContentLoaded", function(event) {
                document.getElementById("claimed-title").innerHTML = `${job.countClaimed}/${job.maxClaims} people claimed`;
            });

            // update logo-image with injectedObject.image
            document.addEventListener("DOMContentLoaded", function(event) {
                document.getElementById("logo-image").src = payer.image;
            });

            task.socials.map((item) => {
                if (item.type === "TWITTER") {
                    document.addEventListener("DOMContentLoaded", function(event) {
                        document.getElementById("twitter-card").display = block;
                        document.getElementById("twitter-button").innerHTML = item.buttonText;
                    });
                } else if (item.type === "DISCORD") {
                    document.addEventListener("DOMContentLoaded", function(event) {
                        document.getElementById("discord-card").display = block;
                        document.getElementById("discord-button").innerHTML = item.buttonText;
                    });
                }            
            });
            // hide twitter button if twitterComplete is false
            document.addEventListener("DOMContentLoaded", function(event) {
                if (task.connected.TWITTER == true) {
                    document.getElementById("twitter-table-button").style.display = "none";
                    document.getElementById("twitter-table-tick-icon").style.display = "block";
                } else {
                    document.getElementById("twitter-table-button").style.display = "block";
                    document.getElementById("twitter-table-tick-icon").style.display = "none";
                }
            });

            // hide twitter button if twitterComplete is false
            document.addEventListener("DOMContentLoaded", function(event) {
                if (task.connected.DISCORD == true) {
                    document.getElementById("discord-table-button").style.display = "none";
                    document.getElementById("discord-table-tick-icon").style.display = "block";
                } else {
                    document.getElementById("discord-table-button").style.display = "block";
                    document.getElementById("discord-table-tick-icon").style.display = "none";
                }
            });
        </script>

        <style>
            .modal {
                display: none;
                position: fixed;
                z-index: 1;
                padding-top: 100px;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgb(0,0,0);
                background-color: rgba(0,0,0,0.4);
                padding-bottom: 30px;
            }

            .modal-content {
                background-color: #000;
                margin: auto;
                padding: 20px;
                /* border: 1px solid #888; */
                /* width: 80%; */
            }

            .close {
                color: #aaaaaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }

            .close:hover,
            .close:focus {
                color: #000;
                text-decoration: none;
                cursor: pointer;
            }
            
            .modal-title {
                font-family: 'Inter';
                font-style: normal;
                font-weight: 600;
                font-size: 20px;
                line-height: 125%;
                display: flex;
                align-items: center;
                text-align: center;
                letter-spacing: 0.1px;
                color: #FFFFFF;
                margin-top: 57px;
                margin-bottom: 31px;
                justify-content: center;
            }

            .blue-button {
                background: linear-gradient(90.07deg, #3999F9 29.06%, #4A7DFF 96.96%);
                border-radius: 8px;
                font-family: 'Inter';
                font-style: normal;
                font-weight: 600;
                font-size: 12px;
                line-height: 125%;
                display: flex;
                align-items: center;
                letter-spacing: 0.1px;
                color: #FFFFFF;
                padding: 6px;
                width: 65px;
                text-align: center;
                justify-content: center;
                box-shadow: none;
                border: none;
                padding-top: 12px;
                padding-bottom: 12px;
            }
        </style>

        <style>
             * {
                font-family: 'Poppins', monospace;
                color: white;
            }            

            .wrapper-card {
                background: linear-gradient(180deg, #110F40 0%, #1B1694 70.31%, #6F09DB 100%);
                border-radius: 16px;
                padding: 18px 12px;
            }

            .title {
                font-family: 'Poppins';
                font-style: normal;
                font-weight: 600;
                font-size: 20px;
                line-height: 24px;
                letter-spacing: -1px;
                color: #FFFFFF;
                margin-bottom: 20px;
                max-width: 225px;
            }

            .claimed-title {
                font-family: 'Inter';
                font-style: normal;
                font-weight: 500;
                font-size: 11px;
                line-height: 125%;
                display: flex;
                align-items: center;
                text-align: center;
                letter-spacing: 0.1px;
                color: #FFFFFF;
                opacity: 0.4;
                margin-top: 12px;
                margin-bottom: 12px;
                width: 100%;
                justify-content: center;
            }

            .rounded-wrapper {
                background: rgba(255, 255, 255, 0.08);
                border-radius: 12px;
                padding: 12px 12px;
                font-family: 'Inter';
                font-style: normal;
                font-weight: 500;
                font-size: 14px;
                line-height: 125%;
                display: flex;
                align-items: center;
                letter-spacing: 0.1px;
                color: #FFFFFF;
                justify-content: space-between;
                margin-top: 20px;
            }

            .table:first-child {
                background: rgba(255, 255, 255, 0.08);
                border-radius: 12px 12px 4px 4px;
                padding: 22px 12px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 2px;
                display: none;
            }

            .table:last-child {
                background: rgba(255, 255, 255, 0.08);
                border-radius: 4px 4px 12px 12px;
                padding: 22px 12px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 2px;
                display: none;
            }

            .table-card {
                background: rgba(255, 255, 255, 0.08);
                border-radius: 4px;
                padding: 22px 12px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 2px;
                display: none;
            }

            .table-card-title {
                font-family: 'Inter';
                font-style: normal;
                font-weight: 500;
                font-size: 14px;
                line-height: 125%;
                display: flex;
                align-items: center;
                letter-spacing: 0.1px;
                color: #FFFFFF;
            }

            .table-card-button {
                background: linear-gradient(219.64deg, #FF5C66 6.71%, #B004FF 52.64%, #7200FF 93.17%);
                border-radius: 12px;
                font-family: 'Inter';
                font-style: normal;
                font-weight: 600;
                font-size: 12px;
                line-height: 125%;
                display: flex;
                align-items: center;
                letter-spacing: 0.1px;
                color: #FFFFFF;
                padding: 6px;
                width: 65px;
                text-align: center;
                justify-content: center;
                box-shadow: none;
                border: none;
            }

            #status-text {
                font-family: 'Inter';
                font-style: normal;
                font-weight: 500;
                font-size: 14px;
                line-height: 18px;
                text-align: center;
                letter-spacing: 0.2px;
                color: #FF6060;
                display: flex;
                justify-content: center;
            }
        </style>
    </head>

    <body style="padding: 16px; background-color: #000;">
        <div class="wrapper-card">
            <img src="" id="logo-image" style="margin-bottom: 12px;">
            <br/>
            <div id="title" class="title"></div>
            <div class="rounded-wrapper">
                <span id="description"></span>
                <img src="./assets/icons/dollar_coin.svg" style="width: 65px; position: relative; top: 11px;">
            </div>
            <span class="claimed-title"></span>

            <div class="table">
                <div id="twitter-card" class="top-table-card table-card">
                    <span class="table-card-title">Twitter</span>
                    <button id="twitter-table-button" onclick="triggerTwitterFollowFlow()" class="table-card-button">Follow</button>
                    <div id="twitter-table-tick-icon" style="display: none; background: rgba(0, 0, 0, 0.08); border-radius: 12px; padding: 4px;">
                        <img src="./assets/icons/tick.svg" />
                    </div>
                    
                </div>
                <div id="discord-card" class="bottom-table-card table-card">
                    <span class="table-card-title">Discord</span>
                    <button id="discord-table-button" onclick="triggerDiscordLoginFlow()" class="table-card-button">Log in</button>
                    <div id="discord-table-tick-icon" style="display: none; background: rgba(0, 0, 0, 0.08); border-radius: 12px; padding: 4px;">
                        <img src="./assets/icons/tick.svg" />
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal -->
        <div id="twittermodal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModalTwitter()">&times;</span>
                <span class="modal-title">Enter your twitter @</span>
                <input id="twitter-input-box" placeholder="Enter twitter username" style="background: #141624; width: 100%; padding: 21px 15px; border: none !important;"/>
                <span style="margin-top: 20px;" id="status-text-twitter"> </span>
                <button style="margin-top: 20px; width: 100%;" onclick="checkTwitterAPIForFollow()" class="blue-button">Submit</button>
            </div>
        </div>

        <div id="discordmodal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModalDiscord()">&times;</span>
                <span class="modal-title">Enter your discord username</span>
                <input id="discord-input-box" placeholder="Enter Discord username" style="background: #141624; width: 100%; padding: 21px 15px; border: none !important;"/>
                <span style="margin-top: 20px;" id="status-text-discord"> </span>
                <button style="margin-top: 20px; width: 100%;" onclick="checkDiscordAPIForJoin()" class="blue-button">Submit</button>
            </div>
        </div>

    </body>

    <script>
        triggerTwitterFollowFlow = () => {
            // open modal
            showModalTwitter();
            // window.open("https://twitter.com/intent/follow?screen_name=LeagueKingdoms", '_blank');
        };

        triggerDiscordLoginFlow = () => {
            window.open("https://discord.gg/leagueofkingdoms", '_blank');
        };

        checkTwitterAPIForFollow = () => {
            console.log('asdfsaf');
            const twitterUsername = document.getElementById('twitter-input-box').value;
            console.log(twitterUsername);
            if (twitterUsername) {
                //      window.open(`https://twitter.com/${twitterUsername}`, '_blank');
                // Show success message
                // Hide modal
                // closeModalTwitter();
                // update status text
                // make api call to check if user is following
                // if yes, show success message
                // if no, show error message
                const success = true;
                if(success) {
                    document.getElementById('status-text-twitter').innerHTML = 'Success! You are now following ' + gameName;
                    injectedObject.twitterComplete = true; // setting the attribute in injected object to true
                    // closeModalTwitter after waiting 500ms
                    setTimeout(() => {
                        closeModalTwitter();
                    }, 1500);
                } else {
                // Show error message
                    document.getElementById('status-text-twitter').innerHTML = 'This twitter username is not following ' + gameName;                    
                }
            } else {
                document.getElementById('status-text-twitter').innerHTML = 'Please enter a valid twitter username';
            }
        };

        checkDiscordAPIForJoin = () => {
            console.log('discord');
            const discordUsername = document.getElementById('discord-input-box').value;
            console.log(discordUsername);
            if (discordUsername) {
                //      window.open(`https://twitter.com/${twitterUsername}`, '_blank');
                // Show success message
                // Hide modal
                // closeModalTwitter();
                // update status text
                // make api call to check if user is following
                // if yes, show success message
                // if no, show error message
                const success = true;
                if(success) {
                    document.getElementById('status-text-discord').innerHTML = 'Success! You are now following ' + gameName;
                    injectedObject.twitterComplete = true; // setting the attribute in injected object to true
                    // closeModalTwitter after waiting 500ms
                    setTimeout(() => {
                        closeModalDiscord();
                    }, 1500);
                } else {
                // Show error message
                    document.getElementById('status-text-discord').innerHTML = 'This twitter username is not following ' + gameName;                    
                }
            } else {
                document.getElementById('status-text-discord').innerHTML = 'Please enter a valid twitter username';
            }
        };

        

    </script>
    <!-- <script type="application/javascript" src="./index.js"></script> -->

</html>